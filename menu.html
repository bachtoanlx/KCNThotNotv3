
<!-- NhÃºng CSS cá»§a Bootstrap -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
<style>
    /* Äáº·t kiá»ƒu máº·c Ä‘á»‹nh cho menu (áº©n menu trÃªn mÃ n hÃ¬nh nhá») */
.menu {
    display: none; /* áº¨n menu trÃªn mÃ n hÃ¬nh nhá» */
    background-color: #333;
    padding: 10px;
}

.menu ul {
    list-style-type: none;
    padding: 0;
    margin: 0;
}

.menu ul li {
    margin: 10px 0;
}

.menu ul li a {
    color: white;
    text-decoration: none;
}

/* Äá»‹nh kiá»ƒu cho nÃºt menu */
.menu-toggle {
    display: none; /* áº¨n nÃºt menu trÃªn mÃ n hÃ¬nh lá»›n */
    background-color: #333;
    color: white;
    border: none;
    padding: 10px;
    cursor: pointer;
}

/* CÃ¡c kiá»ƒu cho mÃ n hÃ¬nh nhá» hÆ¡n 768px (cháº³ng háº¡n nhÆ° di Ä‘á»™ng) */
@media (max-width: 768px) {
    .menu {
        display: block; /* Hiá»ƒn thá»‹ menu trÃªn mÃ n hÃ¬nh nhá» khi nÃºt menu Ä‘Æ°á»£c nháº¥n */
    }

    .menu-toggle {
        display: block; /* Hiá»ƒn thá»‹ nÃºt menu trÃªn mÃ n hÃ¬nh nhá» */
    }

    .menu {
        display: none; /* Menu áº©n máº·c Ä‘á»‹nh trÃªn mÃ n hÃ¬nh nhá» */
    }
}

/* CÃ¡c kiá»ƒu cho mÃ n hÃ¬nh lá»›n hÆ¡n 768px (cháº³ng háº¡n nhÆ° mÃ¡y tÃ­nh báº£ng hoáº·c mÃ¡y tÃ­nh Ä‘á»ƒ bÃ n) */
@media (min-width: 769px) {
    .menu {
        display: block; /* Hiá»ƒn thá»‹ menu trÃªn mÃ n hÃ¬nh lá»›n */
    }

    .menu-toggle {
        display: none; /* áº¨n nÃºt menu trÃªn mÃ n hÃ¬nh lá»›n */
    }
}


</style>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <a class="navbar-brand" id="navbarTitle" href="#">Giáº£i phÃ¡p cÃ´ng nghá»‡ sá»‘</a>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item">
                    <a class="nav-link" href="index.html">Trang chá»§</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="statisticsDropdown1" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Dá»¯ liá»‡u
                    </a>
                    <div class="dropdown-menu" aria-labelledby="statisticsDropdown">
                        <a class="dropdown-item" href="datatable.html">Äá»“ng há»“</a>
                        <a class="dropdown-item" href="datatable_2.html">ThÃ´ng bÃ¡o nghá»‰</a>
                        <a class="dropdown-item" href="datatable_3.html">Äiá»‡n sáº£n xuáº¥t</a>
                        <a class="dropdown-item" href="datatable_4.html">NÆ°á»›c sinh hoáº¡t</a>
                        <a class="dropdown-item" href="datatable_5.html">Äiá»‡n máº·t trá»i</a>
                    </div>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="statisticsDropdown2" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        BÃ¡o cÃ¡o
                    </a>
                    <div class="dropdown-menu" aria-labelledby="statisticsDropdown">
                        <a class="dropdown-item" href="statistics.html">BC LÆ°u lÆ°á»£ng</a>
                        <a class="dropdown-item" href="statistics_2.html">BC NgÃ y nghá»‰</a>
                        <a class="dropdown-item" href="statistics_3.html">BC Äiá»‡n sáº£n xuáº¥t</a>
                        <a class="dropdown-item" href="statistics_4.html">BC NÆ°á»›c sinh hoáº¡t</a>
                        <a class="dropdown-item" href="statistics_5.html">BC Äiá»‡n máº·t trá»i</a>
                    </div>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="statisticsDropdown3" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Táº¡o ThÃ´ng bÃ¡o
                    </a>
                    <div class="dropdown-menu" aria-labelledby="statisticsDropdown">
                        <a class="dropdown-item" href="notification.html">DN ngÆ°ng sáº£n xuáº¥t</a>
                        <a class="dropdown-item" href="index.html">LÆ°u lÆ°á»£ng Ä‘á»“ng há»“</a>
                        <a class="dropdown-item" href="notification_2.html">Sáº£n lÆ°á»£ng Äiá»‡n sáº£n xuáº¥t</a>
                        <a class="dropdown-item" href="notification_3.html">Sáº£n lÆ°á»£ng NÆ°á»›c sinh hoáº¡t</a>
                        <a class="dropdown-item" href="notification_4.html">Sáº£n lÆ°á»£ng Äiá»‡n máº·t trá»i</a>
                        <a class="dropdown-item" href="notification_5.html">Thu phÃ­ nÆ°á»›c tháº£i</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="about.html">LiÃªn há»‡</a>
                </li>
            </ul>
            <ul class="navbar-nav ml-auto">
                <li class="nav-item" id="loginLogoutButton">
                    <a class="nav-link" href="#" id="loginButton">ÄÄƒng nháº­p</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- Modal Menu ÄÄƒng nháº­p -->
<div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="loginModalLabel">ÄÄƒng nháº­p</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="loginFormElement">
                    <div class="form-group">
                        <label for="username">TÃªn Ä‘Äƒng nháº­p:</label>
                        <input type="text" class="form-control" id="username" name="username" autocomplete="current-password">
                    </div>
                    <div class="form-group">
                        <label for="password">Máº­t kháº©u:</label>
                        <input type="password" class="form-control" id="password" name="password" autocomplete="current-password">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">ÄÃ³ng</button>
                <button type="button" class="btn btn-primary" id="loginSubmitButton">ÄÄƒng nháº­p</button>
            </div>
        </div>
    </div>
</div>
<!-- Bootstrap JS vÃ  jQuery (cáº§n thiáº¿t cho Bootstrap) -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>


<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

<script>
    // Xá»­ lÃ½ Menu -->
function toggleMenu() {
    var menu = document.querySelector('.menu');
    menu.style.display = (menu.style.display === 'block' || menu.style.display === '') ? 'none' : 'block';
}

// HÃ m Ä‘á»ƒ Ä‘Ã³ng menu
function closeMenu() {
    const navbarCollapse = document.getElementById('navbarNav');
    if (navbarCollapse && navbarCollapse.classList.contains('show')) {
        // Náº¿u menu Ä‘ang má»Ÿ, Ä‘Ã³ng nÃ³
        const collapse = new bootstrap.Collapse(navbarCollapse, {
            toggle: false
        });
        collapse.hide();
    }
}



// ğŸ“Œ 1. áº¨n ná»™i dung ngay khi trang táº£i lÃªn (giá»¯ UI á»•n Ä‘á»‹nh)
function initializePage() {
    $('.protected-content').addClass('hidden-content');
    $('.admin-content').addClass('blur-content');
    
    var savedUser = localStorage.getItem('loggedInUser');
    var savedRole = localStorage.getItem('loggedInRole');
    

    // âœ… Náº¿u Ä‘Ã£ Ä‘Äƒng nháº­p trÆ°á»›c Ä‘Ã³, hiá»ƒn thá»‹ lá»i chÃ o ngay láº­p tá»©c
    if (savedUser && savedRole) {
        updateUIForLoggedInUser(savedUser, savedRole);
    } else {
        $('#loginModal').modal('show'); // âœ… Hiá»ƒn thá»‹ modal náº¿u chÆ°a Ä‘Äƒng nháº­p
    }
}

// ğŸ“Œ 2. Cáº­p nháº­t UI khi user Ä‘Äƒng nháº­p
function updateUIForLoggedInUser(username, role) {
    $('#loginModal').modal('hide');
    $('#navbarTitle').text('Xin chÃ o, ' + username);
    $('#loginButton').text('ÄÄƒng xuáº¥t');
    $('#loginModal').modal('hide'); // âœ… Äáº£m báº£o modal bá»‹ áº©n náº¿u Ä‘Ã£ Ä‘Äƒng nháº­p
    showProtectedContent(role); // Hiá»ƒn thá»‹ ná»™i dung theo quyá»n
}

// ğŸ“Œ 3. Cáº­p nháº­t UI khi user Ä‘Äƒng xuáº¥t
function updateUIForLoggedOutUser() {
    $('#navbarTitle').text('Giáº£i phÃ¡p cÃ´ng nghá»‡ sá»‘'); // âœ… KhÃ´ng cáº­p nháº­t náº¿u trang Ä‘ang táº£i
    $('#loginButton').text('ÄÄƒng nháº­p');
    hideProtectedContent();
    $('#loginModal').modal('show'); // âœ… Hiá»ƒn thá»‹ modal khi Ä‘Äƒng xuáº¥t
}

// ğŸ“Œ 4. Kiá»ƒm tra Ä‘Äƒng nháº­p tá»« `localStorage` hoáº·c GAS (chá»‰ sau 30 phÃºt)
function checkLoginStatus(username) {
    const lastCheck = localStorage.getItem('lastLoginCheck');
    const now = Date.now();
    const thirtyMinutes = 30 * 60 * 1000; // 30 phÃºt

    if (lastCheck && (now - parseInt(lastCheck) < thirtyMinutes)) {
        console.log("â³ ÄÃ£ kiá»ƒm tra gáº§n Ä‘Ã¢y, khÃ´ng gá»i API GAS.");
        return;
    }

    console.log("ğŸ” Kiá»ƒm tra Ä‘Äƒng nháº­p vá»›i GAS...");
    var url = `https://script.google.com/macros/s/AKfycbzg9lkoiVZeVE7kXcDV7gVa7lijeXjP-tAHukkv4lac5fXNzBJNOLYQEiSyu9cVgkmy/exec?username=${username}`;

    $.getJSON(url, function(response) {
        if (response.success) {
            localStorage.setItem('lastLoginCheck', now);
            localStorage.setItem('loggedInRole', response.role);
        } else {
            logoutUser();
        }
    }).fail(function() {
        console.warn("KhÃ´ng thá»ƒ kiá»ƒm tra tÃ i khoáº£n, cÃ³ thá»ƒ do lá»—i máº¡ng.");
    });
}

// ğŸ“Œ 5. Xá»­ lÃ½ Ä‘Äƒng nháº­p khi ngÆ°á»i dÃ¹ng nháº­p thÃ´ng tin
$('#loginSubmitButton').click(function() {
    $('#loginModal').modal('hide');
    $('#loaderModal').modal('show');
    var username = $('#username').val();
    var password = $('#password').val();
    var url = "https://script.google.com/macros/s/AKfycbzg9lkoiVZeVE7kXcDV7gVa7lijeXjP-tAHukkv4lac5fXNzBJNOLYQEiSyu9cVgkmy/exec";

    $.getJSON(url, { username: username, password: password }, function(response) {
        if (response.success) {
            localStorage.setItem("loggedInUser", username);
            localStorage.setItem("lastLoginCheck", Date.now());
            localStorage.setItem("loggedInRole", response.role);
            
            updateUIForLoggedInUser(username, response.role);
            
            $('#loaderModal').modal('hide');
            toastr.success("ÄÄƒng nháº­p thÃ nh cÃ´ng!", "ThÃ nh cÃ´ng");
        } else {
            toastr.error("TÃªn Ä‘Äƒng nháº­p hoáº·c máº­t kháº©u khÃ´ng chÃ­nh xÃ¡c!", "Lá»—i");
        }
    }).fail(function() {
        toastr.error("Lá»—i káº¿t ná»‘i Ä‘áº¿n server!", "Lá»—i");
    });
});

// ğŸ“Œ 6. Xá»­ lÃ½ Ä‘Äƒng xuáº¥t khi ngÆ°á»i dÃ¹ng nháº¥n nÃºt
$('#loginButton').click(function() {
    if ($(this).text() === "ÄÄƒng xuáº¥t") {
        logoutUser();
    } else {
        $('#loginModal').modal('show');
    }
});

// ğŸ“Œ 7. ÄÄƒng xuáº¥t vÃ  cáº­p nháº­t UI ngay láº­p tá»©c
function logoutUser() {
    localStorage.removeItem("loggedInUser");
    localStorage.removeItem("lastLoginCheck");
    localStorage.removeItem("loggedInRole");

    updateUIForLoggedOutUser();
    toastr.success("Báº¡n Ä‘Ã£ Ä‘Äƒng xuáº¥t thÃ nh cÃ´ng!", "ÄÄƒng xuáº¥t");
 
}

// ğŸ“Œ 8. áº¨n ná»™i dung báº£o vá»‡ khi Ä‘Äƒng xuáº¥t
function hideProtectedContent() {
    $('.protected-content').addClass('hidden-content');
    $('.admin-content').addClass('blur-content');
}

// ğŸ“Œ 9. Hiá»ƒn thá»‹ ná»™i dung báº£o vá»‡ theo quyá»n
function showProtectedContent(role) {
    $('.protected-content').removeClass('hidden-content');

    if (role === 'admin') {
        $('.admin-content').removeClass('blur-content');
    } else {
        $('.admin-content').addClass('blur-content');
    }
}

// ğŸ“Œ 10. Khi trang táº£i lÃªn, kiá»ƒm tra tráº¡ng thÃ¡i Ä‘Äƒng nháº­p
$(document).ready(function() {
    initializePage();
    var savedUser = localStorage.getItem('loggedInUser');
    if (savedUser) {
        checkLoginStatus(savedUser);
    }
});





</script>